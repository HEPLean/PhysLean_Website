---
layout: default
---

<!-- Documentation tracker -->

<!-- Some style choices -->

<style>
    :root {
        --bg-color: #2E3440;
        --fg-color: #D8DEE9;
        --link-color: #81A1C1;
        --button-bg: #4CAF50;
        --button-text: #FFFFFF;
        --border-color: #4C566A;
        --list-bg: #3B4252;
        --list-text: #A3BE8C;
    }



    a {
        color: var(--link-color);
        text-decoration: none;
    }

    a:hover {
        text-decoration: underline;
    }

    #graph {
        border: 1px solid var(--border-color);
        border-radius: 8px;
        margin-bottom: 20px;
        background-color: #fff;
        /* Graph background is usually white */
    }

    ul {
        list-style-type: disc;
        padding-left: 20px;
    }

    li {
        margin-bottom: 8px;
    }

    .custom-graph-container {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
    }

    .list-container {
        flex: 1;
        min-width: 300px;
    }

    #sources-list,
    #targets-list {
        height: 200px;
        overflow-y: auto;
        border: 1px solid var(--border-color);
        background-color: var(--list-bg);
        color: var(--list-text);
        font-family: monospace;
        padding: 10px;
        border-radius: 8px;
        font-size: 0.9em;
    }

    #sources-list div,
    #targets-list div {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 2px 0;
    }

    input[type="checkbox"] {
        accent-color: var(--button-bg);
    }

    #renderBtn {
        font-size: 1.2em;
        padding: 10px 20px;
        margin-top: 1em;
        background-color: var(--button-bg);
        color: var(--button-text);
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease;
        width: 100%;
    }

    #renderBtn:hover {
        background-color: #45a049;
    }

    code {
        background-color: var(--list-bg);
        color: var(--list-text);
        padding: 2px 5px;
        border-radius: 4px;
    }
</style>

<h1>Helping with documentation</h1>
<!-- Downloading d3js -->

<script src="//d3js.org/d3.v7.min.js"></script>
<script src="https://unpkg.com/@hpcc-js/wasm@2.20.0/dist/graphviz.umd.js"></script>
<script src="https://unpkg.com/d3-graphviz@5.6.0/build/d3-graphviz.js"></script>

<!-- Creating script to color dot-files. -->


<!-- Rendering the graph. -->
<script>
    async function graphFormat(dotFile) {
        // Getting lines from https://raw.githubusercontent.com/HEPLean/PhysLean/master/scripts/MetaPrograms/module_doc_no_lint.txt 
        const response = await fetch('https://raw.githubusercontent.com/HEPLean/PhysLean/master/scripts/MetaPrograms/module_doc_no_lint.txt');
        const text = await response.text();
        const undocumentedModules = new Set(text.split('\n').filter(line => line.trim() !== ''));
        // Transfrom the entries in undocumentedModules from e.g. 
        // PhysLean/ClassicalMechanics/RigidBody/SolidSphere.lean
        // to
        // PhysLean.ClassicalMechanics.RigidBody.SolidSphere 
        const transformedModules = new Set();
        undocumentedModules.forEach(modulePath => {
            const moduleName = modulePath.replace(/\//g, '.').replace('.lean', '');
            transformedModules.add(moduleName);
        }); 
        // Now, color the nodes in the dotFile
        // Find all nodes and color them based on whether they are in transformedModules
        const nodeRegex = /"([^"]+)"\s*\[([^\]]*)\]/g;
        dotFile = dotFile.replace(nodeRegex, (match, nodeName, existingAttributes) => {
            const isUndocumented = transformedModules.has(nodeName);
            const fillColor = isUndocumented ? '#FFCCCC' : '#CCFFCC'; // Light red or light green
            const urlOfNode = `https://github.com/HEPLean/PhysLean/blob/master/${nodeName.replace(/\./g, '/')}.lean`;
            
            // Add URL and fill color to the node attributes
            existingAttributes += `, URL="${urlOfNode}"`;
            let newAttributes;
            if (existingAttributes.includes('style=')) {
            // Style attribute exists, add/replace fillcolor
            if (existingAttributes.includes('fillcolor=')) {
                newAttributes = existingAttributes.replace(/fillcolor="[^"]+"/, `fillcolor="${fillColor}"`);
            } else {
                newAttributes = existingAttributes.replace('style="', `style="filled, `).replace('style=', `style=filled, `) + `, fillcolor="${fillColor}"`;
            }
            } else {
            // No style attribute, add it
            const separator = existingAttributes.trim() === '' ? '' : ', ';
            newAttributes = existingAttributes + separator + `style=filled, fillcolor="${fillColor}"`;
            }
            
            return `"${nodeName}" [${newAttributes}]`;
        });

        return dotFile
    }
    function renderGraph() {
        console.log("Rendering graph");
        fetch('./assets/my_graph.dot')
            .then(response => response.text())
            .then(dotText => graphFormat(dotText))
            .then(dotFile => {
                d3.select("#graph")
                    .graphviz()
                    .zoom(true)
                    .zoomScaleExtent([0.1, Infinity])
                    .fit(true)
                    .width("100%")
                    .height("500px") // Increased height for better viewing
                    .renderDot(dotFile);
            })
            .catch(error => console.error('Error fetching dot file:', error));
    }
</script>

<div id="graph"></div>
<script>
    renderGraph();
</script>

<p>Graph controls: Use mouse to pan, use scroll or two fingers to zoom in/out. Click on nodes to navigate to their 
    GitHub entry.</p>


<p>Eventually we want to turn all the nodes in this graph green by adding documentation. 
To help follow the steps below!</p>

<h2>Steps to help with documentation</h2>
<p>This whole process can be done without downloading Lean, but having it installed provides helpful tools.</p>

<h3>Phase 1: Get the Code</h3>
<ol>
    <li>Fork the <a href="https://github.com/HEPLean/PhysLean">PhysLean GitHub repository</a>.
        (Copy the master branch only)</li>
    <li>Clone your forked repository to your local machine. (Optional, you can also edit directly on GitHub)</li>
</ol>

There are many good tutorials on the GitHub steps involved in these instructions, see e.g. 
  <a href="https://www.youtube.com/watch?v=H2Hg8g0lWiE">Youtube video</a> as an example 
of some of the GitHub steps involved here. 
<h3>Phase 2: Choose a File to Document</h3>
<ol>
    <li>Use the graph above to identify an undocumented file (a red node) where you think you could help.</li>
    <li>In your local copy of PhysLean, open the file <code>./scripts/MetaPrograms/module_doc_no_lint.txt</code>.</li>
    <li>Remove the line corresponding to the file you want to document.</li>
    <li>Navigate to the file you want to document.</li>
</ol>

<h3>Phase 3: Write the Documentation</h3>
<p>You can write the documentation manually or use a helper script if you have Lean installed.
    See any of the green nodes in the graph for examples of good documentation.
</p>

<h4>Option A: Without Lean</h4>
<p>Edit the <code>.lean</code> file you chose and add the following sections:</p>
<ol>
    <li><strong>Module Title:</strong> Add a title heading at the top of the file, starting with <code># </code>.</li>
    <li><strong>Overview:</strong> Add an <code>## i. Overview</code> section after the title, explaining the physical content of the module.</li>
    <li><strong>Key Results:</strong> Add a <code>## ii. Key results</code> section. This should list the key definitions, theorems, and lemmas with brief explanations.</li>
    <li><strong>Table of Contents:</strong> Add a <code>## iii. Table of contents</code> section. This can be left blank and will be filled in automatically later.</li>
    <li><strong>References:</strong> Add a <code>## iv. References</code> section for any relevant literature.</li>
    <li><strong>Structure the Code:</strong> Organize the rest of the file with section and subsection headings (e.g., <code>## A.</code>, <code>### A.1.</code>, <code>#### A.1.2</code>).</li>
</ol>

<h4>Option B: With Lean</h4>
<p>If you have Lean installed, a script can help you structure the documentation.</p>
<ol>
    <li>Run <code>lake exe module_doc_lint</code> in your terminal.</li>
    <li>Follow the interactive steps, using existing documented files as a guide.</li>
</ol>

<h3>Phase 4: Submit Your Changes</h3>
<ol>
    <li>Commit your changes to your forked repository.</li>
    <li>Create a pull request to the main PhysLean repository for review.</li>
</ol>
    